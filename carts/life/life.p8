pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--conway's game of life
--by amiantos

debug_mode=false

function _init() menu_init() end

function menu_init()
	_update=menu_update
	_draw=menu_draw
end

function menu_update()
	if (btnp(❎)) game_init() --play the game
end

menu_label = "press ❎ to start"
function menu_draw()
	cls()
	print(menu_label,hcenter(menu_label),61,7)
end
-->8
all_cells={}
living_cells={}
dying_cells={}

cell_grid={}

max_x = 64
max_y = 64
multiplier=128/max_y

cell_size = 2

initial_cells = 500

update_time = 0.05

function game_init()
	_update=game_update
	_draw=game_draw

	cls()

	last_update=time()

	all_cells={}
	living_cells={}
	dying_cells={}
	cell_grid={}

	for i=1,max_x do
		cell_grid[i]={}
		for j=1,max_y do
			log("creating cell for " .. i .. "," .. j)
			local cell={}
			--initial dead state
			cell.state=0
			cell.x=i
			cell.y=j
			cell_grid[i][j]=cell
			add(all_cells,cell)
		end
	end
	
	--mark some random cells as alive
	log("creating random living cells")
	for i=1,initial_cells do
		rnd_x=rndb(1,max_x)
		rnd_y=rndb(1,max_y)
		cell_grid[rnd_x][rnd_y].state=1
		add(living_cells,cell_grid[rnd_x][rnd_y])
	end
end

function game_update()
	if btnp(❎) then
		menu_init()
	elseif (time()-last_update > update_time) then
		c_life=cocreate(update_life)
		coresume(c_life)
		last_update=time()
	end
end

function game_draw()
	if (not last_draw) or (time()-last_draw > update_time) then
		--draw living cells
		for c in all(living_cells) do
			rect(c.x*multiplier,c.y*multiplier+1,c.x*multiplier+1,c.y*multiplier,8)
		end

		-- draw dead cells
		for c in all(dying_cells) do
			rect(c.x*multiplier,c.y*multiplier+1,c.x*multiplier+1,c.y*multiplier,1)
		end

		last_draw=time()
	end
end

function update_life()
	living_cells={}
	dying_cells={}
	for cell in all(all_cells) do
		l_cells=0
		n={}
		add(n,{x=cell.x,y=inc(cell.y)})
		add(n,{x=cell.x,y=dcr(cell.y)})
		add(n,{x=inc(cell.x),y=cell.y})
		add(n,{x=dcr(cell.x),y=cell.y})
		add(n,{x=dcr(cell.x),y=dcr(cell.y)})
		add(n,{x=inc(cell.x),y=inc(cell.y)})
		add(n,{x=dcr(cell.x),y=inc(cell.y)})
		add(n,{x=inc(cell.x),y=dcr(cell.y)})
		for n in all(n) do
			if cell_grid[n.x][n.y].state==1 then
				l_cells+=1
			end
		end
		if cell.state==1 then
			if (l_cells>3 or l_cells<2) then
				add(dying_cells,cell)
			else
				add(living_cells,cell)
			end
		elseif l_cells == 3 then
			add(living_cells,cell)
		end
	end

	for cell in all(living_cells) do
		cell.state=1
		cell_grid[cell.x][cell.y].state=1
	end

	for cell in all(dying_cells) do
		cell.state=0
		cell_grid[cell.x][cell.y].state=0
	end
end

-->8
function hcenter(string)
	return 64-#string*2
end

function rndb(low,high)
	return flr(rnd(high-low+1)+low)
end

function log(string)
	if (debug_mode) printh(string)
end


function inc(z)
	local value=z+1
	if (value>max_y) return 1
	return value
end

function dcr(z)
	local value=z-1
	if (value<1) return max_y
	return value
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00118811111188118888881111111111881100001111111111118888111188111111111111111100000000000011111111881111111188880000110011000011
00118811111188118888881111111111881100001111111111118888111188111111111111111100000000000011111111881111111188880000110011000011
00888811888888111111881111118811881100001100000000110088888811001111110011110000001100001111111188111111881111111111000000000000
00888811888888111111881111118811881100001100000000110088888811001111110011110000001100001111111188111111881111111111000000000000
00008811118811118888111111888811888811110000000000000000880000111111111111110000111111001111111111881111118811881111000000001100
00008811118811118888111111888811888811110000000000000000880000111111111111110000111111001111111111881111118811881111000000001100
00000088881111118811111111118811888811110011001100000011000011111111111111111111001111111111111111111188888811110000118800001111
00000088881111118811111111118811888811110011001100000011000011111111111111111111001111111111111111111188888811110000118800001111
00001111111100111111111111111188111111110000111111111111111111111111111111111111111111111111111111111111118811111111881188110000
00001111111100111111111111111188111111110000111111111111111111111111111111111111111111111111111111111111118811111111881188110000
00111111000000111111111111111111111111111111111111111111111111111111888811111111111111111111001111111111001111111111111111110000
00111111000000111111111111111111111111111111111111111111111111111111888811111111111111111111001111111111001111111111111111110000
00111111000000001100001100001111111111111111111111111111111111111111888811111188118888111111000011111100001111111111111111110000
00111111000000001100001100001111111111111111111111111111111111111111888811111188118888111111000011111100001111111111111111110000
00111100000000000000000011110000111111111111888888111111111111111111111111111111888888111111111111111111111111111111111111110011
00111100000000000000000011110000111111111111888888111111111111111111111111111111888888111111111111111111111111111111111111110011
00000000110000000000000000111111111111111111118888111100111111111111111111111111881111118800111111888811111111111111111100001100
00000000110000000000000000111111111111111111118888111100111111111111111111111111881111118800111111888811111111111111111100001100
00000000001100000000000088888811111111118888118888000011001111111188111111111111888888881100111111888811111111111111111111110000
00000000001100000000000088888811111111118888118888000011001111111188111111111111888888881100111111888811111111111111111111110000
00001100000000001100000011111111111111881188111111111111111111118811881111111111881111880011111111111111111111888888111111000000
00001100000000001100000011111111111111881188111111111111111111118811881111111111881111880011111111111111111111888888111111000000
00000000000011110000000011111100001111118811111111111111111111118811880011111111888888000011111111111111111111111111111111000000
00000000000011110000000011111100001111118811111111111111111111118811880011111111888888000011111111111111111111111111111111000000
00111100888811111100111111118811111111111111111111111100000011111188111111111111111100000011111111888888111111888811110000000011
00111100888811111100111111118811111111111111111111111100000011111188111111111111111100000011111111888888111111888811110000000011
00111188111188111111111188111188110000111111111111111100000000111100111111111111111100000000111111888888111111111111111100000000
00111188111188111111111188111188110000111111111111111100000000111100111111111111111100000000111111888888111111111111111100000000
00111188111188001111111188111188001111001111111111111100110000001111111111111111110000000000001111111111111111111111111100000000
00111188111188001111111188111188001111001111111111111100110000001111111111111111110000000000001111111111111111111111111100000000
00001111111188111111111111880000111111111111111111111111111100001111111111110000111111000011000011111111001111111111111111000000
00001111111188111111111111880000111111111111111111111111111100001111111111110000111111000011000011111111001111111111111111000000
00001111111111111111000000111111111111118888111188110011111100000011111111111111111100110000000011111100000011111111111111111111
00001111111111111111000000111111111111118888111188110011111100000011111111111111111100110000000011111100000011111111111111111111
00000011888811888888888800111111111111118888118811111111110011111111111111111111110011000000000000111100000000001111111111111111
00000011888811888888888800111111111111118888118811111111110011111111111111111111110011000000000000111100000000001111111111111111
00000088118888888888118888111111111111881188888888111111111100001111111111111111110000000000000011110000000000000000001111111111
00000088118888888888118888111111111111881188888888111111111100001111111111111111110000000000000011110000000000000000001111111111
00111111111111111111118888111111111111881111111111111111111111111111111188111111000000111111111111111100008811000000001188111111
00111111111111111111118888111111111111881111111111111111111111111111111188111111000000111111111111111100008811000000001188111111
00111111111111111111888811111111111111111111111111881111111111111111118811881111111111111111110011110000118888000000118811881111
00111111111111111111888811111111111111111111111111881111111111111111118811881111111111111111110011110000118888000000118811881111
00111111118888881111111111111111111111111111111188888811111111111111118811880000001111111111111111111111881111110000118811881111
00111111118888881111111111111111111111111111111188888811111111111111118811880000001111111111111111111111881111110000118811881111
00111111118888880011111111111111111100111111111188888811111111111111111188000011111111111111111111111111118811880000001188111111
00111111118888880011111111111111111100111111111188888811111111111111111188000011111111111111111111111111118811880000001188111111
00111111118888111111111111111111110011118811111111888811111111111111110000001100111111111111111188888888888888110000111111111111
00111111118888111111111111111111110011118811111111888811111111111111110000001100111111111111111188888888888888110000111111111111
00111111111111111111111111111111000011888811111111888811111111111111001100111111111111111111111188111111881111110000111111118888
00111111111111111111111111111111000011888811111111888811111111111111001100111111111111111111111188111111881111110000111111118888
00111111111111111111111111111111000000008888111188888811110011110000000000111111111111111111001111881188111111000011110000111111
00111111111111111111111111111111000000008888111188888811110011110000000000111111111111111111001111881188111111000011110000111111
00111111111111111111111111111111111100001111111188111111110000000011000000001100001111111111111111118811111111111111110011118888
00111111111111111111111111111111111100001111111188111111110000000011000000001100001111111111111111118811111111111111110011118888
00118811111111111100001111118811111111000000888888111100000000000000000011001111000011001111111111111111111111111111111111888888
00118811111111111100001111118811111111000000888888111100000000000000000011001111000011001111111111111111111111111111111111888888
00888811111111111111000000881188111111110000111111881100001111000000111111000000000000111111111111111111111111110011111100111111
00888811111111111111000000881188111111110000111111881100001111000000111111000000000000111111111111111111111111110011111100111111
00111188111111111111000011118800111111000088111111118888001111118888111111110000000000111111111111111111111111110000008811111111
00111188111111111111000011118800111111000088111111118888001111118888111111110000000000111111111111111111111111110000008811111111
00118811111111111111110011000000000000000088111111111111111111881111881111111100000088111111111100111111110000000000118811111111
00118811111111111111110011000000000000000088111111111111111111881111881111111100000088111111111100111111110000000000118811111111
00881111111111111111110000000000000000000000881188111111111100008888111111110000008811881111111111111111110011110000008888111111
00881111111111111111110000000000000000000000881188111111111100008888111111110000008811881111111111111111110011110000008888111111
00881111111111111111111100000000000000110000111111118811110000001111111111110000111111881111118811111111001188888800111111111188
00881111111111111111111100000000000000110000111111118811110000001111111111110000111111881111118811111111001188888800111111111188
00111111111111111111111100000000000011111111118811118811881111001111111188880011118888881111118811111111110011111111111111111111
00111111111111111111111100000000000011111111118811118811881111001111111188880011118888881111118811111111110011111111111111111111
00111111111111111111111100000000001111111111111111111111888811881111118811888888881111111111118811111111111111111111110011111100
00111111111111111111111100000000001111111111111111111111888811881111118811888888881111111111118811111111111111111111110011111100
00111111111111111111111111000000001111111111111188881188888888118800111188111188111111881111111111111100111111111111111100000000
00111111111111111111111111000000001111111111111188881188888888118800111188111188111111881111111111111100111111111111111100000000
00111111111111111111111111110011111111111111111111111111118811118811111111111111888888111111111111110000111111111111111100000000
00111111111111111111111111110011111111111111111111111111118811118811111111111111888888111111111111110000111111111111111100000000
00001111111111111111111111110011111111111188881111111111111188881111111111111111118811111111111100000000881111111111110011111111
00001111111111111111111111110011111111111188881111111111111188881111111111111111118811111111111100000000881111111111110011111111
00111111111111111111111111110000111111118811888888111111111111111111111111111111111111111111111100000088888811111111000011111111
00111111111111111111111111110000111111118811888888111111111111111111111111111111111111111111111100000088888811111111000011111111
00111111118811118888881111111111111111118888118888881111111111111111111111111111111111111111110000008888881188111111110011111111
00111111118811118888881111111111111111118888118888881111111111111111111111111111111111111111110000008888881188111111110011111111
00111111111188111188111111110011111100111188881111888811111111111111111111111111111188881111110000888811111188111111111111111111
00111111111188111188111111110011111100111188881111888811111111111111111111111111111188881111110000888811111188111111111111111111
00111111111188888888111111111111111111111188888811888811111111111111111111111111111188881111110088881188888811111111111111111111
00111111111188888888111111111111111111111188888811888811111111111111111111111111111188881111110088881188888811111111111111111111
00111111111111111111111111111111111100001111881111118811111111001111111111111111111111111111000011881188881111111111111111001111
00111111111111111111111111111111111100001111881111118811111111001111111111111111111111111111000011881188881111111111111111001111
00111111111111111111888811111111110000000011008811881111111111111111111111111111111111110011001111111111111111111111111100000011
00111111111111111111888811111111110000000011008811881111111111111111111111111111111111110011001111111111111111111111111100000011
00111188881111118888118888118811110011110000110088001111111111111111111111000011111111111111000011888888111111111111000000008811
00111188881111118888118888118811110011110000110088001111111111111111111111000011111111111111000011888888111111111111000000008811
00118888881111118888888888881111111111110011000000110011111111001111110000001111111111111111000011111188111111111111111100888888
00118888881111118888888888881111111111110011000000110011111111001111110000001111111111111111000011111188111111111111111100888888
00118811881111111111881111111111111111118888880000001100111100000000000000001111111111001100001111881188111111110011111111881111
00118811881111111111881111111111111111118888880000001100111100000000000000001111111111001100001111881188111111110011111111881111
00111111111111118811881111111111111111111111110000000000001100001111110000001111111100000000001111881111111111111111110000111111
00111111111111118811881111111111111111111111110000000000001100001111110000001111111100000000001111881111111111111111110000111111
00111111111111881111111100111111111188111111111188000000001100000011000000111111111100110000111111111111111111110011110011111111
00111111111111881111111100111111111188111111111188000000001100000011000000111111111100110000111111111111111111110011110011111111
00111111111111118811881100001111001188111111111188110000001111000000000000110000110011111111111111111111111111110011111111111111
00111111111111118811881100001111001188111111111188110000001111000000000000110000110011111111111111111111111111110011111111111111
00111111111111111188110000001100000088111111111188000000001111000011111111000000111111110011118888111111111111001111111111111111
00111111111111111188110000001100000088111111111188000000001111000011111111000000111111110011118888111111111111001111111111111111
00111111881111111111000000000000001111111111110011111100000000000011111111111111110011001111118888111111111111111111111111111111
00111111881111111111000000000000001111111111110011111100000000000011111111111111110011001111118888111111111111111111111111111111
00111111118811111100001100000000111111118888881111111111000000001111111111111111111111111111881111111111111111001111111111111111
00111111118811111100001100000000111111118888881111111111000000001111111111111111111111111111881111111111111111001111111111111111
00888811118888111111001111000011111111000011000011001100001100111111111100111111111111111111111111111111111111111111111100111111
00888811118888111111001111000011111111000011000011001100001100111111111100111111111111111111111111111111111111111111111100111111
00118811118888881111110000001111111100000011110000110000000000001100001111111111111111111111111111118811111111111111110000001188
00118811118888881111110000001111111100000011110000110000000000001100001111111111111111111111111111118811111111111111110000001188
00118811881188118811000000111111110011001111110000000011000000000011000011111111111111111111111111111111111111111100000000008811
00118811881188118811000000111111110011001111110000000011000000000011000011111111111111111111111111111111111111111100000000008811
00118811888888881111008888111111110000001111110000000000000011000000001100111111111111111111111100111111111111111100000000001188
00118811888888881111008888111111110000001111110000000000000011000000001100111111111111111111111100111111111111111100000000001188
00111188881111111111118888111100000000000000000000111111000011110000000000111111111111111111110000000011111111111100110000000011
00111188881111111111118888111100000000000000000000111111000011110000000000111111111111111111110000000011111111111100110000000011
00111111111111111111110000111100000000000000000011118811881188111100000000001111111111111111111100110011111111000011000000000000
00111111111111111111110000111100000000000000000011118811881188111100000000001111111111111111111100110011111111000011000000000000
00111111118888111111111100110000000000000000111111118811111111118800000000001111111100000000111100000011111111000000000000000000
00111111118888111111111100110000000000000000111111118811111111118800000000001111111100000000111100000011111111000000000000000000
00111111881111881111111111000000000000000000111111118811118811111188001111111100111111110011111111000000110000000000000000001111
00111111881111881111111111000000000000000000111111118811118811111188001111111100111111110011111111000000110000000000000000001111
00111111111188881111111111111111000000000000111111111188888811118811111111111111001111111111111111001100110000000000000000111111
00111111111188881111111111111111000000000000111111111188888811118811111111111111001111111111111111001100110000000000000000111111
00111111881111001111111111118811110000000000001111111188888888881111111111001100000011111111111111111111888800000000000011111111
00111111881111001111111111118811110000000000001111111188888888881111111111001100000011111111111111111111888800000000000011111111

