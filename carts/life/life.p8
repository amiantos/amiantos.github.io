pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--conway's game of life
--by amiantos.net

debug_mode=false

--global vars
all_cells={}
living_cells={}
dying_cells={}

cell_colors={}

max_x = 64
max_y = 64

cell_size = 2

initial_cells = 500

update_time = 0.05

life_color=8
dead_color=1

life_colors={8,9,10,11}

updating=false
drawing=false

-->8
--menu
function _init() menu_init() end

function menu_init()
	_update=menu_update
	_draw=menu_draw
end

function menu_update()
	if (btnp(❎)) game_init() --play the game
end

title_label = "conway's game of life"
start_label = "press ❎ to start life"
instruction_label = "hold ❎ to end life"
function menu_draw()
	cls()
	print(title_label,hcenter(title_label),47,7)
	print(start_label,hcenter(start_label),61,7)
	print(instruction_label, hcenter(instruction_label),69,7)
end
-->8
--life

function game_init()
	_update=game_update
	_draw=game_draw

	cls()

	last_update=time()

	all_cells={}
	living_cells={}
	dying_cells={}
	cell_colors={}

	for i=1,max_x do
		cell_colors[i]={}
		for j=1,max_y do
			log("creating cell for " .. i .. "," .. j)
			local cell={}
			cell.x=i
			cell.y=j
			cell_colors[i][j]=rndb(8,11)
			add(all_cells,cell)
		end
	end
	
	--mark some random cells as alive
	log("creating random living cells")
	for i=1,initial_cells do
		add(living_cells,{x=rndb(1,max_x),y=rndb(1,max_y)})
	end
end

function game_update()
	if btnp(❎) then
		menu_init()
	elseif (not drawing) and (time()-last_update > update_time) then
		update_life()
		last_update=time()
	end
end

function game_draw()
	draw_life()
end

function draw_life()
	if (not updating) and ((not last_draw) or (time()-last_draw > update_time)) then
		drawing=true

		--draw living cells
		for c in all(living_cells) do
			rect(c.x*2,c.y*2+1,c.x*2+1,c.y*2,cell_colors[c.x][c.y])
		end

		-- draw dead cells
		for c in all(dying_cells) do
			rect(c.x*2,c.y*2+1,c.x*2+1,c.y*2,dead_color)
		end

		last_draw=time()
		drawing=false
	end
end

function update_life()
	updating=true

	living_cells={}
	dying_cells={}
	for cell in all(all_cells) do
		l_cells=0
		l_colors={}
		--create neighbor coords
		n={}
		add(n,{x=cell.x,y=inc(cell.y)})
		add(n,{x=cell.x,y=dcr(cell.y)})
		add(n,{x=inc(cell.x),y=cell.y})
		add(n,{x=dcr(cell.x),y=cell.y})
		add(n,{x=dcr(cell.x),y=dcr(cell.y)})
		add(n,{x=inc(cell.x),y=inc(cell.y)})
		add(n,{x=dcr(cell.x),y=inc(cell.y)})
		add(n,{x=inc(cell.x),y=dcr(cell.y)})
		for nc in all(n) do
			if alive(nc.x,nc.y) then
				l_cells+=1
				add(l_colors,cell_colors[nc.x][nc.y])
			end
		end
		log("cell (" .. cell.x .. "," .. cell.y .. ") living neighbors: " .. l_cells)
		if alive(cell.x,cell.y) then
			if (l_cells>3 or l_cells<2) then
				add(dying_cells,cell)
			else
				cell_colors[cell.x][cell.y]=l_colors[rndb(1,#l_colors)]
				add(living_cells,cell)
			end
		elseif l_cells == 3 then
			cell_colors[cell.x][cell.y]=l_colors[rndb(1,#l_colors)]
			add(living_cells,cell)
		end
	end

	updating=false
end

-->8
--utils

function alive(x,y)
	local color=pget(x*2,y*2)
	return color==8 or color==9 or color==10 or color==11
end

function hcenter(string)
	return 64-#string*2
end

function rndb(low,high)
	return flr(rnd(high-low+1)+low)
end

function log(string)
	if (debug_mode) printh(string)
end


function inc(z)
	local value=z+1
	if (value>max_y) return 1
	return value
end

function dcr(z)
	local value=z-1
	if (value<1) return max_y
	return value
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000111100000000110000aa11aa0000000000000011000000000000001111000000000011001111aaaa111111111111111111111111111100
000000000000000000111100000000110000aa11aa0000000000000011000000000000001111000000000011001111aaaa111111111111111111111111111100
000000000000111111111100000000001111aa1111aa1111000000000011000000000011110000000000000000111111aa111111aaaa1111bbbb111111111100
000000000000111111111100000000001111aa1111aa1111000000000011000000000011110000000000000000111111aa111111aaaa1111bbbb111111111100
00110000000000111111110000000000111111aa11aaaa000000000000111100001100000000001100000011111111aa11111111aaaa11bb1111bb1111110000
00110000000000111111110000000000111111aa11aaaa000000000000111100001100000000001100000011111111aa11111111aaaa11bb1111bb1111110000
000000110000000011000000110000aaaa111111aaaaaa0000000000001100000000000000000000001111111111aaaa11111111111111111111111111000000
000000110000000011000000110000aaaa111111aaaaaa0000000000001100000000000000000000001111111111aaaa11111111111111111111111111000000
000000000000000000000000000000aaaaaaaa11aa1100110000000011000000000000000000110000111111aa11111111111111001111aa11bb111111000000
000000000000000000000000000000aaaaaaaa11aa1100110000000011000000000000000000110000111111aa11111111111111001111aa11bb111111000000
000000000000000000001100000000111111aa11111100000000000000110000110000000000000000111111aaaaaaaa11111100000011aaaa00110000001100
000000000000000000001100000000111111aa11111100000000000000110000110000000000000000111111aaaaaaaa11111100000011aaaa00110000001100
00000000001100000000000011000000111111111111000000001100111100001100000000000000000011110000aa1111000000000000000000000000000000
00000000001100000000000011000000111111111111000000001100111100001100000000000000000011110000aa1111000000000000000000000000000000
0000000000000000000000000000000011aaaaaa1100000000000000111100000000000000000000000011000000000000000011000000110000110000000011
0000000000000000000000000000000011aaaaaa1100000000000000111100000000000000000000000011000000000000000011000000110000110000000011
0000000000000000000011000000110000aaaaaa0000000000000000000000000011111100000000000000000000000000000000001111000000000000000000
0000000000000000000011000000110000aaaaaa0000000000000000000000000011111100000000000000000000000000000000001111000000000000000000
000000000000000000001111000011000000aa000000000000000000000011110000001111000000000000000000110000001100000011000000000000000000
000000000000000000001111000011000000aa000000000000000000000011110000001111000000000000000000110000001100000011000000000000000000
00110000000000000011000000000000000000110011000000001100001111111111111111000000000000110000000000000000000000000000000000000000
00110000000000000011000000000000000000110011000000001100001111111111111111000000000000110000000000000000000000000000000000000000
00000000000000000000000000000000000000001100000000000000001111001111111100110000000011000000000000000000000000000011000000000000
00000000000000000000000000000000000000001100000000000000001111001111111100110000000011000000000000000000000000000011000000000000
00000000001111111100000000000000000000000011000011000011000011000011000000000000001100000000001100000011000000000000000000110000
00000000001111111100000000000000000000000011000011000011000011000011000000000000001100000000001100000011000000000000000000110000
00000000000011110011000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000011110011000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011000000001111000000001100000011000000000000000000000000000000000000000000000000000000000000000000001100000000000011000000
00000011000000001111000000001100000011000000000000000000000000000000000000000000000000000000000000000000001100000000000011000000
00000000000000000000000000111100000011000011000000000000999900000000001111110000000011110000000000000000000000110000000011000000
00000000000000000000000000111100000011000011000000000000999900000000001111110000000011110000000000000000000000110000000011000000
00000000000000000000110000000000000000000000000000000011999911000000000011111111000000000000000000000000000000000011000000000000
00000000000000000000110000000000000000000000000000000011999911000000000011111111000000000000000000000000000000000011000000000000
00001100000000110000000000000000001100000000000000000000000000000011000000111111000000000000000000000000000000000000110011111100
00001100000000110000000000000000001100000000000000000000000000000011000000111111000000000000000000000000000000000000110011111100
00000000110011110000000000000000000000110000000000001100000000001100000000000000000000000000000000001100001100000000111111111100
00000000110011110000000000000000000000110000000000001100000000001100000000000000000000000000000000001100001100000000111111111100
00000000111111111100110000000000000000000000000000000000000011000000000000000000000000110000001100000000000000000011001111000011
00000000111111111100110000000000000000000000000000000000000011000000000000000000000000110000001100000000000000000011001111000011
001100001111111100000000000000000000000000000000000000000011aaaa0000000000000000000000111100000000001111000000000000000000000000
001100001111111100000000000000000000000000000000000000000011aaaa0000000000000000000000111100000000001111000000000000000000000000
0000001111111111000000000000000000001100000000001100000000aa1111aa11110000000000000011110000000000111100000000000000000011000000
0000001111111111000000000000000000001100000000001100000000aa1111aa11110000000000000011110000000000111100000000000000000011000000
000000000011000000000000000000110000000000000000000000000000aaaa1111001100000000000000110000001100000000000000000000000000110000
000000000011000000000000000000110000000000000000000000000000aaaa1111001100000000000000110000001100000000000000000000000000110000
00000000000000000000000000000011000000000000000000000011000011000011000000001111000000000000000000000000000000000000000011000000
00000000000000000000000000000011000000000000000000000011000011000011000000001111000000000000000000000000000000000000000011000000
00000000000000000000000000001100110000000000001100000000000000000000000000001111000000000000000000000000000000000000001111000000
00000000000000000000000000001100110000000000001100000000000000000000000000001111000000000000000000000000000000000000001111000000
00000000000000000000001100000000000000000000000000000000001100000000000011000011000000000011000000000000001100000000111100000000
00000000000000000000001100000000000000000000000000000000001100000000000011000011000000000011000000000000001100000000111100000000
00111100000000000000001100000000001100000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000
00111100000000000000001100000000001100000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000
00000000000000001111110000000000bbbb00000000000000000000001100000000001100000000000000000011000000000000000000000000001100000000
00000000000000001111110000000000bbbb00000000000000000000001100000000001100000000000000000011000000000000000000000000001100000000
00000000000000001111110000000000bbbb00000000001100110011000000000000000000000000000000000000110000000000000000000000000000001100
00000000000000001111110000000000bbbb00000000001100110011000000000000000000000000000000000000110000000000000000000000000000001100
00000000000000111111000000000000001100000000000011001100000000000000000000000000000000000000111100000011000000110000000000001100
00000000000000111111000000000000001100000000000011001100000000000000000000000000000000000000111100000011000000110000000000001100
0000000000000000aaaa110000000000000000000000000000110000110000000000000000000011000011000000000000000000110000001100001100000000
0000000000000000aaaa110000000000000000000000000000110000110000000000000000000011000011000000000000000000110000001100001100000000
0000000000000000aaaa110000000000001100001111000000001100000011000000000011000000001111110000000000000088888800000000000011110000
0000000000000000aaaa110000000000001100001111000000001100000011000000000011000000001111110000000000000088888800000000000011110000
00000000000000000000001100000000000000110000110000000011000000000000000011110000000000110000000000000011110000001100000000111100
00000000000000000000001100000000000000110000110000000011000000000000000011110000000000110000000000000011110000001100000000111100
000000110000000000000000110000000000000000111100000000111100000000000000aaaaaa00000000110000000000000000000000000000000011111100
000000110000000000000000110000000000000000111100000000111100000000000000aaaaaa00000000110000000000000000000000000000000011111100
00000000000000000000000000110000000000000000110000000011001100000000000011110000000000000000000000000000000000000000001100110000
00000000000000000000000000110000000000000000110000000011001100000000000011110000000000000000000000000000000000000000001100110000
000011000000000000001100000000000000000000000011000000110000aaaa1100000000001100000000000000000000000000000000000000000000000000
000011000000000000001100000000000000000000000011000000110000aaaa1100000000001100000000000000000000000000000000000000000000000000
0000000000000000118888110000000011000011000000000000000000aa1111aa00000000000000000000000011000000111100000000000011000000000000
0000000000000000118888110000000011000011000000000000000000aa1111aa00000000000000000000000011000000111100000000000011000000000000
000088880000000000888811111100000000111111110000000000000011aaaa0000000000000000000000110000000000000000001111000000000000000011
000088880000000000888811111100000000111111110000000000000011aaaa0000000000000000000000110000000000000000001111000000000000000011
0011888811000000000011001111000000001111aaaa000000000011000000000000000000000000000000000000000000000000000000001100000000000000
0011888811000000000011001111000000001111aaaa000000000011000000000000000000000000000000000000000000000000000000001100000000000000
00111111110000000000000000000000000000aaaaaa000000000000000000000000110000000011000011000011000000000000000000000000000000001100
00111111110000000000000000000000000000aaaaaa000000000000000000000000110000000011000011000011000000000000000000000000000000001100
001111bb11000000000000000000000011000011aaaa110000000000000000000000000000000000000000000000000000000000000000000000000000000000
001111bb11000000000000000000000011000011aaaa110000000000000000000000000000000000000000000000000000000000000000000000000000000000
001111bb110000110000000000000000111111111111110000000000110000000011000000000000000000000011000000000011000000001100110000000000
001111bb110000110000000000000000111111111111110000000000110000000011000000000000000000000011000000000011000000001100110000000000
001111bbbbbb00001100000000000000000011111111001100001100000000000000000000000000000000000000000000110000000000000000000000110000
001111bbbbbb00001100000000000000000011111111001100001100000000000000000000000000000000000000000000110000000000000000000000110000
0011111111bbbb001111000000110000111111111100000000000000000000000000110000000000111100000000000011110000000000000000000000110000
0011111111bbbb001111000000110000111111111100000000000000000000000000110000000000111100000000000011110000000000000000000000110000
001111111111bbbb0000000000000000001111110000110000000000001100000000001100000011110000001111000011110000000000000000000011000000
001111111111bbbb0000000000000000001111110000110000000000001100000000001100000011110000001111000011110000000000000000000011000000
0011111111bbbb000000001100000000000000000000110000000000001100000000001111001111000000000000000000000000000000000000001111000000
0011111111bbbb000000001100000000000000000000110000000000001100000000001111001111000000000000000000000000000000000000001111000000
00001111111100000000000000001100000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000001111
00001111111100000000000000001100000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000001111
00000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000111100110000000000000011000000000000
00000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000111100110000000000000011000000000000
00110011110000001100000000000000000000000000000000000000000000000000000000000000000000000000001111000000110000001100000011000000
00110011110000001100000000000000000000000000000000000000000000000000000000000000000000000000001111000000110000001100000011000000
0000000011110000110000000000000000000000000011000000001111110000000000000000001100000000000000001100000000000000bb00111111000000
0000000011110000110000000000000000000000000011000000001111110000000000000000001100000000000000001100000000000000bb00111111000000
00000000000000000000000000000000001100000011111100000000110000000000000000000000000000000000008888000000000000bbbb111111bbbb0000
00000000000000000000000000000000001100000011111100000000110000000000000000000000000000000000008888000000000000bbbb111111bbbb0000
0000000000000000000000000000bb00000000000011111111000000000000000000bb00000000000000110000000088880000000000bb1111bbbb1111000000
0000000000000000000000000000bb00000000000011111111000000000000000000bb00000000000000110000000088880000000000bb1111bbbb1111000000
0000110000000000000000000011bb11000000000000001100000000000000000011bb1100000011000000000000000011000000000011bbbbbbbbbbbbbb0000
0000110000000000000000000011bb11000000000000001100000000000000000011bb1100000011000000000000000011000000000011bbbbbbbbbbbbbb0000
00000000000000000000000011bb11bb000000000000000000000011000000000000bb00110000000000001100000000000000000011111111bb1111bbbb0011
00000000000000000000000011bb11bb000000000000000000000011000000000000bb00110000000000001100000000000000000011111111bb1111bbbb0011
00001100001100000000001111bbbb1100000000000000001100000000000000000000000011000000000000110000000000000000111111111111bbbbbb0000
00001100001100000000001111bbbb1100000000000000001100000000000000000000000011000000000000110000000000000000111111111111bbbbbb0000
000000000000110000001111bbbb111100000000000000111100000000000000001100000000000000000011111100000000000000001111111111bb11bb0000
000000000000110000001111bbbb111100000000000000111100000000000000001100000000000000000011111100000000000000001111111111bb11bb0000
001100000000000000000011bbbb111111000000000000111111110000000000000000000000000000000011111100000000000000000011111100aa11aaaa00
001100000000000000000011bbbb111111000000000000111111110000000000000000000000000000000011111100000000000000000011111100aa11aaaa00
0000000000001100000000bb11bb111111bb0000000000111111110000000000000000000011000011000011110011009999000000000000000000aa11aaaa00
0000000000001100000000bb11bb111111bb0000000000111111110000000000000000000011000011000011110011009999000000000000000000aa11aaaa00
0000000000000011000000bb11bb1111bb11bb000011110011110011001100000000000000000000000000110000000099990000000000110000aaaaaa11aaaa
0000000000000011000000bb11bb1111bb11bb000011110011110011001100000000000000000000000000110000000099990000000000110000aaaaaa11aaaa
000000001100000000000000bb111111bb11bb00000000000000000000000000000000000011000000000000000000000000000000000000aaaaaa111111aaaa
000000001100000000000000bb111111bb11bb00000000000000000000000000000000000011000000000000000000000000000000000000aaaaaa111111aaaa
0000110000000000000000000000111111bb1100000000000000110000000000000000000011110000000000110000000000000000000000aa11111111111111
0000110000000000000000000000111111bb1100000000000000110000000000000000000011110000000000110000000000000000000000aa11111111111111
0011110000000000001100000000001111111100001100000000110000000000000000000011000000110000000000000000000000000000aa11aa111111aaaa
0011110000000000001100000000001111111100001100000000110000000000000000000011000000110000000000000000000000000000aa11aa111111aaaa
000000110011001100000000000000000000110000000011000000000000000000000000000000000000000000000000000011000000000000aaaa111111aaaa
000000110011001100000000000000000000110000000011000000000000000000000000000000000000000000000000000011000000000000aaaa111111aaaa

